<!-- mathjax config similar to math.stackexchange -->

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" }},
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      processEscapes: true
    },
    "HTML-CSS": { matchFontHeight: false },
    displayAlign: "left",
    displayIndent: "2em"
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery-balloon-js@1.1.2/jquery.balloon.min.js" integrity="sha256-ZEYs9VrgAeNuPvs15E39OsyOJaIkXEEt10fzxJ20+2I=" crossorigin="anonymous"></script>

<script type="text/javascript" src="../../../assets/js/copy-button.js"></script>

<p><link rel="stylesheet" href="../../../assets/css/copy-button.css" /></p>
<h1>:warning: structure/verify/atcoder-shpc-2018-final-e-2.cpp</h1>
<ul>
<li>category: structure/verify</li>
</ul>
<p><a href="../../../index.html">Back to top page</a></p>
<h2>Code</h2>
<pre><code class="cpp">using pi = pair&lt; int, int &gt;;
using int64 = long long;
const int mod = 1e9 + 7;
int64 power[234567];

inline pi none(pi x, int y) { return x; }

inline int none(int x, int y) { return x; }

inline pi F(pi x, pi y) {
  return pi((1LL * y.first * power[x.second] + x.first % mod) % mod, x.second + y.second);
};


int main() {
  int N, M;
  string S[20];

  power[0] = 1;
  for(int i = 0; i &lt; 234566; i++) power[i + 1] = 1LL * power[i] * 1000000 % mod;

  cin &gt;&gt; N &gt;&gt; M;
  for(int i = 0; i &lt; M; i++) cin &gt;&gt; S[i];
  vector&lt; vector&lt; pair&lt; int, int &gt; &gt; &gt; dat(M, vector&lt; pair&lt; int, int &gt; &gt;(N));
  for(int i = 0; i &lt; M; i++) {
    for(int j = 0; j &lt; N; j++) {
      dat[i][j].first = S[i][j] - 'a';
      dat[i][j].first++;
      dat[i][j].second = 1;
    }
  }
  using T = RedBlackTree&lt; pi, int, F, none, none, none &gt;;
  T beet(M * N * 2, pi(0, 0), 0);
  vector&lt; T::Node * &gt; root;
  for(int i = 0; i &lt; M; i++) root.push_back(beet.build(dat[i]));

  int Q;
  cin &gt;&gt; Q;
  while(Q--) {
    int T, A, B, C, D;
    cin &gt;&gt; T &gt;&gt; A &gt;&gt; B &gt;&gt; C &gt;&gt; D;
    --A, --B, --C;
    if(T == 1) {
      auto S = beet.split(root[A], D);
      auto T = beet.split(S.first, C);
      auto U = beet.split(root[B], D);
      auto V = beet.split(U.first, C);
      root[A] = beet.merge(T.first, beet.merge(V.second, S.second));
      root[B] = beet.merge(V.first, beet.merge(T.second, U.second));
    } else {
      auto S = beet.split(root[A], D);
      auto T = beet.split(S.first, C);
      printf(&quot;%d\n&quot;, beet.sum(T.second).first);
      root[A] = beet.merge(beet.merge(T.first, T.second), S.second);
    }
  }
}

</code></pre>

<p><a href="../../../index.html">Back to top page</a></p>